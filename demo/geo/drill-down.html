<html>
  <head>
    <script src="https://unpkg.com/react@15/dist/react.min.js"></script>
    <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>
    <script src="https://cdn.bootcss.com/babel-core/5.8.38/browser.min.js"></script>
    <script src="https://unpkg.alipay.com/@ali/bizcharts@3.0.0-rc5.4/dist/bizcharts"> </script>
    <script type="text/javascript" src="https://unpkg.alipay.com/@antv/data-set@0.5.2/build/data-set.js"></script>
    <script type="text/javascript" src="https://gw.alipayobjects.com/as/g/datavis/assets/1.0.1/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="https://a.alipayobjects.com/g/datavis/china-geojson/1.0.0/index.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
  </head>
  <body>
      <div id="mountNode" ></div>
      <script type="text/babel">
      const { Chart, Geom, Axis, Tooltip, Coord, Label, Legend, View, Guide, Shape, G2 } = window.BizCharts;
      $('#mountNode').html('<div style="position:relative;padding-left:250px;">' +
        '<div id="china" style="position: absolute;top:5px;left:5px;"></div>' +
        '<div id="province"></div>' +
    '</div>');
      function processData(mapData) {
          // 构造虚拟数据
          const userData = [];
          const features = mapData.features;
          for (let i = 0; i < features.length; i++) {
              const name = features[i].properties.name;
              userData.push({
                  name: name,
                  value: Math.round(Math.random() * 1000),
              });
          }
          const ds = new DataSet();
          const geoDataView = ds.createView().source(mapData, {
              type: 'GeoJSON',
          }); // geoJSON 经纬度数据
  
          // 用户数据
          const dvData = ds.createView().source(userData);
          dvData.transform({
              type: 'geo.region',
              field: 'name',
              geoDataView: geoDataView,
              as: ['longitude', 'lantitude'],
          });
  
          return dvData;
      }
  
      function renderProvinceChart(name) {
          const provinceData = ChinaGeoJSON[name];
          // provinceChart.clear();
          if (!provinceData) {
              return false;
          }
          return (
              <Chart container='province' data={processData(provinceData)} width={500} height={window.innerHeight} padding={[20, 80, 40, 40]}>
                <Tooltip showTitle={false} />
                <Geom 
                  type='polygon'
                  position='longitude*lantitude'
                  style={{lineWidth: 1, stroke: '#fff'}} 
                  color={['value', '#e5f5e0-#31a354']}
                >
                  <Label content='name' textStyle={{fill: '#333',fontSize: 10}} />
                </Geom>
              </Chart>
          )
      }
      let hasProvinceChart;
      const mapData = ChinaGeoJSON['China'];
      console.log(mapData, G2);
      const shapes = G2.chart.getAllGeoms()[0].getShapes();

      // getProvinceChart(ev) {
      //     const shape = ev.shape;
      //     if (!shape) {
      //         return false;
      //     }
      //     if (shape.get('selected')) {
      //         const item = shape.get('origin');
      //         const data = item['_origin'];
      //         const name = data.name;
      //         hasProvinceChart = renderProvinceChart(name);
      //     }
      // }
    ReactDOM.render((
            <Chart height={180} container='china' width={250} data={processData(mapData)} padding={0} forceFit>
              <Tooltip showTitle={false} />
              <Geom 
                type='polygon' 
                position='longitude*lantitude' 
                select={{
                    // 设置是否允许选中以及选中样式
                    mode: 'single', // 多选还是单选
                    style: {
                        fill: '#fe9929', // 选中的样式
                    },
                }} 
                tooltip='name' 
                style={{lineWidth: 1,globalAlpha: 0.9,cursor: 'pointer',stroke: '#999',fill: '#ccc'}} 
                color={['count', [ 'rgb(200, 200, 255)', 'rgb(0, 0, 255)' ]]} 
              />
            </Chart>
      ), document.getElementById("mountNode"));
    </script>
  </body>
</html>