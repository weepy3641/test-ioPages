<html>
  <head>
    <script src="https://unpkg.com/react@15/dist/react.min.js"></script>
    <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>
    <script src="https://cdn.bootcss.com/babel-core/5.8.38/browser.min.js"></script>
    <script src="https://unpkg.alipay.com/@ali/bizcharts@3.0.0-rc5.4/dist/bizcharts"> </script>
    <script type="text/javascript" src="https://unpkg.alipay.com/@antv/data-set@0.5.2/build/data-set.js"></script>
    <script type="text/javascript" src="https://gw.alipayobjects.com/as/g/datavis/assets/1.0.1/jquery-3.2.1.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
  </head>
  <body>
      <div id="mountNode" ></div>
      <script type="text/babel">
      const { Chart, Geom, Axis, Tooltip, Coord, Label, Legend, View, Guide, Shape, Facet, Util } = window.BizCharts;
      
      Shape.registerShape('polygon', 'boundary-polygon', {
        draw(cfg, container) {
          if (!Util.isEmpty(cfg.points)) {
            const attrs = {
              stroke: '#fff',
              lineWidth: 1,
              fill: cfg.color,
              fillOpacity: cfg.opacity
            };
            const points = cfg.points;
            const path = [
              [ 'M', points[0].x, points[0].y ],
              [ 'L', points[1].x, points[1].y ],
              [ 'L', points[2].x, points[2].y ],
              [ 'L', points[3].x, points[3].y ],
              [ 'Z' ]
            ];
            attrs.path = this.parsePath(path);
            const polygon = container.addShape('path', {
              attrs
            });
    
            if (cfg.origin._origin.lastWeek) {
              const linePath = [
                [ 'M', points[2].x, points[2].y ],
                [ 'L', points[3].x, points[3].y ],
              ];
              // 最后一周的多边形添加右侧边框
              container.addShape('path', {
                zIndex: 1,
                attrs: {
                  path: this.parsePath(linePath),
                  lineWidth: 1,
                  stroke: '#404040'
                }
              });
              if (cfg.origin._origin.lastDay) {
                container.addShape('path', {
                  zIndex: 1,
                  attrs: {
                    path: this.parsePath([
                      [ 'M', points[1].x, points[1].y ],
                      [ 'L', points[2].x, points[2].y ],
                    ]),
                    lineWidth: 1,
                    stroke: '#404040'
                  }
                });
              }
            }
            container.sort();
            return polygon;
          }
        }
      });
  const cols = {
    day: {
      type: 'cat',
      values: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六' ]
    },
    week: {
      type: 'cat'
    },
    commits: {
      sync: true
    }
  }
  $.getJSON('/public/data/github-commit.json',function(data) { 
    ReactDOM.render((
          <Chart height={window.innerHeight} data={data} scale={cols} forceFit padding={[ window.innerHeight / 3, 20, window.innerHeight / 3, 80]}>
            <Tooltip title='date' />
            <Axis name='week'position='top' tickLine={null} line={null} label={
              {
              offset: 12,
              textStyle: {
                fontSize: 12,
                fill: '#666',
                textBaseline: 'top'
              },formatter: val => {
              if (val === '2') {
                return 'MAY';
              } else if (val === '6') {
                return 'JUN';
              } else if (val === '10') {
                return 'JUL';
              } else if (val === '15') {
                return 'AUG';
              } else if (val === '19') {
                return 'SEP';
              } else if (val === '24') {
                return 'OCT';
              }
              return '';
              }
            }}
            />
            <Axis name='day' grid={null} />
            <Geom type='polygon' position="week*day*date" shape='boundary-polygon' color={['commits', '#BAE7FF-#1890FF-#0050B3']} />
            <Coord reflect='y' />
        </Chart>
      ), document.getElementById("mountNode"));
  });
    </script>
  </body>
</html>